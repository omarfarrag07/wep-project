<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Profile</title>
    <link rel="stylesheet" href="profile.css">
    <script>
        // Fetch user profile data
        function fetchProfileData() {
            fetch('http://localhost/wep-project/backend/passengers/edit.php', {
                method: 'GET',
                credentials: 'include',  // Include cookies with the request
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    document.body.innerHTML = `<p><strong>Error:</strong> ${data.error}</p>`;
                    return;
                }

                // Fill the form with existing user data
                document.getElementById('edit-name').value = data.name || '';
                document.getElementById('edit-email').value = data.email || '';
                document.getElementById('edit-phone').value = data.tel || '';
                if (data.photo) {
                    document.getElementById('current-profile-picture').src = `http://localhost/wep-project/uploads/${data.photo}`;
                }
                if (data.passport_img) {
                    document.getElementById('current-passport-image').src = `http://localhost/wep-project/uploads/${data.passport_img}`;
                }
            })
            .catch(error => {
                document.body.innerHTML = `<p><strong>Error:</strong> ${error.message}</p>`;
            });
        }

        // Handle profile update form submission
        function updateProfile(event) {
            event.preventDefault();

            const name = document.getElementById('edit-name').value;
            const email = document.getElementById('edit-email').value;
            const phone = document.getElementById('edit-phone').value;
            const profile_picture = document.getElementById('edit-profile-picture').files[0];
            const passport_image = document.getElementById('edit-passport-image').files[0];

            const formData = new FormData();
            formData.append('name', name);
            formData.append('email', email);
            formData.append('phone', phone);
            if (profile_picture) formData.append('profile_picture', profile_picture);
            if (passport_image) formData.append('passport_image', passport_image);

            fetch('http://localhost/wep-project/backend/passengers/edit.php', {
                method: 'POST',
                credentials: 'include',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                    return;
                }

                // If profile update is successful, navigate to profile page
                alert('Profile updated successfully.');
                window.location.href = 'profile.html'; // Redirect to the profile page
            })
            .catch(error => {
                alert('Error updating profile: ' + error.message);
            });
        }

        // Fetch profile data when the page loads
        window.onload = function() {
            fetchProfileData();
        };
    </script>
</head>
<body>
    <div class="card">
        <div class="card-header">
            <h2>Edit Profile</h2>
        </div>
        <div class="card-body">
            <form onsubmit="updateProfile(event)" enctype="multipart/form-data">
                <p><strong>Name:</strong> <input type="text" id="edit-name" name="name" required></p>
                <p><strong>Email:</strong> <input type="email" id="edit-email" name="email" required></p>
                <p><strong>Phone:</strong> <input type="text" id="edit-phone" name="phone" required></p>
                
                <p><strong>Profile Picture:</strong> <input type="file" id="edit-profile-picture" name="profile_picture" accept="image/*"></p>
                <p><img id="current-profile-picture" width="100" alt="Current Profile Picture"></p>
                
                <p><strong>Passport Image:</strong> <input type="file" id="edit-passport-image" name="passport_image" accept="image/*"></p>
                <p><img id="current-passport-image" width="100" alt="Current Passport Image"></p>

                <button type="submit">Save Changes</button>

            </form>
        </div>
    </div>
</body>
</html>
